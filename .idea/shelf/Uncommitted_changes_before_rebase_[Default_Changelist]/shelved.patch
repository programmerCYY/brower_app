Index: app/src/main/java/com/example/mywebdemo/MainActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.mywebdemo;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.graphics.Bitmap;\r\nimport android.net.Uri;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.KeyEvent;\r\nimport android.view.Menu;\r\nimport android.view.MenuInflater;\r\nimport android.view.MenuItem;\r\nimport android.view.MotionEvent;\r\nimport android.view.View;\r\nimport android.webkit.WebChromeClient;\r\nimport android.webkit.WebResourceResponse;\r\nimport android.webkit.WebSettings;\r\nimport android.webkit.WebView;\r\nimport android.webkit.WebViewClient;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.LinearLayout;\r\nimport android.widget.PopupMenu;\r\nimport android.widget.Toast;\r\n\r\nimport com.example.mywebdemo.adblock.AdBlocker;\r\nimport com.example.mywebdemo.adblock.NoAdWebviewClient;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.LinkedHashSet;\r\nimport java.util.List;\r\nimport java.util.Set;\r\nimport java.util.regex.Matcher;\r\nimport java.util.regex.Pattern;\r\n\r\npublic class MainActivity extends AppCompatActivity {\r\n\r\n\r\n    public ArrayList<String> urlList = new ArrayList<String>();\r\n    public ArrayList<String> nameList = new ArrayList<String>();\r\n    public ArrayList<String> flagList = new ArrayList<String>();\r\n    public String currenturl=\"\";\r\n    private WebView webView ;\r\n    //注册浏览器\r\n    private void initWebView(String url) {\r\n\r\n        webView = (WebView) findViewById(R.id.mywebview);\r\n//        LoadUrl(url);\r\n        WebSettings webSettings = webView.getSettings();\r\n\r\n\r\n        webView.setVerticalScrollBarEnabled(false);\r\n        //窗口设置为手机大小\r\n        webSettings.setUseWideViewPort(true);\r\n        webSettings.setLoadWithOverviewMode(true);\r\n        //设置缓存\r\n        webSettings.setSaveFormData(false);\r\n        webSettings.setSavePassword(false);\r\n        //设置JS支持\r\n        webSettings.setJavaScriptEnabled(true);\r\n        //设置支持缩放变焦\r\n        webSettings.setBuiltInZoomControls(false);\r\n        //设置是否支持缩放\r\n        webSettings.setSupportZoom(false);\r\n        //设置是否允许JS打开新窗口\r\n        webSettings.setJavaScriptCanOpenWindowsAutomatically(true);\r\n\r\n\r\n        // 修复一些机型webview无法点击\r\n//        webView.requestFocus(View.FOCUS_DOWN);\r\n//\r\n//        webView.setOnTouchListener(new View.OnTouchListener() {\r\n//            @Override\r\n//            public boolean onTouch(View v, MotionEvent event) {\r\n//                // TODO Auto-generated method stub\r\n//                switch (event.getAction()) {\r\n//                    case MotionEvent.ACTION_DOWN:\r\n//                    case MotionEvent.ACTION_UP:\r\n//                        if (!v.hasFocus()) {\r\n//                            v.requestFocus();\r\n//                        }\r\n//                        break;\r\n//                }\r\n//                return false;\r\n//            }\r\n//\r\n//        });\r\n\r\n        webView.setWebViewClient(new WebViewClient(){\r\n            boolean if_load;\r\n\r\n\r\n            //页面完成即加入历史记录\r\n            @Override\r\n            public void onPageFinished(WebView view, String url) {\r\n                super.onPageFinished(view, url);\r\n\r\n                if(if_load) {\r\n                    nameList.add(view.copyBackForwardList().getCurrentItem().getTitle());\r\n                    currenturl=view.copyBackForwardList().getCurrentItem().getTitle();\r\n                    urlList.add(currenturl);\r\n                    nameList=removeDuplicate(nameList);\r\n                    urlList=removeDuplicate(urlList);\r\n                    Log.d(\"array\", nameList.toString());\r\n                    if_load=false;\r\n                }\r\n            }\r\n\r\n            //页面开始\r\n            @Override\r\n            public void onPageStarted(WebView view, String url, Bitmap favicon){\r\n                super.onPageStarted(view, url, favicon);\r\n\r\n                if_load=true;\r\n            }\r\n\r\n//            @Override\r\n//            public boolean shouldOverrideUrlLoading(WebView view, String url) {\r\n//                Log.d(\"succeed\", \"shouldOverrideUrlLoading: \"+url);\r\n//                if (url.contains(\".baidu.com\")){\r\n//                    Log.d(\"success\", \"shouldOverrideUrlLoading: \"+url);\r\n//                    view.loadUrl(\"https://www.taobao.com\");\r\n//                }else {\r\n//                    view.loadUrl(url);\r\n//                }\r\n//                return true;\r\n//            }\r\n        });\r\n        Context context = webView.getContext();\r\n        webView.setWebViewClient(new NoAdWebviewClient(context));\r\n        webView.setWebChromeClient(new WebChromeClient(){\r\n            //\r\n        });\r\n        LoadUrl(url);\r\n        //拦截跳转后执行\r\n//        webView.setWebViewClient(new WebViewClient() {\r\n//            @Override\r\n//            public boolean shouldOverrideUrlLoading(WebView view, String url) {\r\n//                LoadUrl(url);\r\n//                return true;\r\n//            }\r\n//\r\n//       });\r\n\r\n\r\n    }\r\n    //去重\r\n    public static ArrayList removeDuplicate(ArrayList list){\r\n        ArrayList tempList = new ArrayList(list.size());\r\n        for(int i=0;i<list.size();i++){\r\n            if(!tempList.contains(list.get(i)))\r\n                tempList.add(list.get(i));\r\n        }\r\n        return tempList;\r\n    }\r\n\r\n    private void LoadUrl(String url) {\r\n        Log.d(\"tag\",\"运行了一次\");\r\n        webView.loadUrl(url);\r\n    }\r\n    //判断http\r\n    public static boolean isHttpUrl(String urls) {\r\n        boolean isurl = false;\r\n        String regex = \"(((https|http)?://)?([a-z0-9]+[.])|(www.))\"\r\n                + \"\\\\w+[.|\\\\/]([a-z0-9]{0,})?[[.]([a-z0-9]{0,})]+((/[\\\\S&&[^,;\\u4E00-\\u9FA5]]+)+)?([.][a-z0-9]{0,}+|/?)\";//设置正则表达式\r\n\r\n        Pattern pat = Pattern.compile(regex.trim());//对比\r\n        Matcher mat = pat.matcher(urls.trim());\r\n        isurl = mat.matches();//判断是否匹配\r\n        if (isurl) {\r\n            isurl = true;\r\n        }\r\n        return isurl;\r\n    }\r\n    //判断www\r\n    public static boolean isUrl(String urls) {\r\n        boolean isurl = false;\r\n        String regex = \"(([a-z0-9]+[.])|(www.))\"\r\n                + \"\\\\w+[.|\\\\/]([a-z0-9]{0,})?[[.]([a-z0-9]{0,})]+((/[\\\\S&&[^,;\\u4E00-\\u9FA5]]+)+)?([.][a-z0-9]{0,}+|/?)\";//设置正则表达式\r\n\r\n        Pattern pat = Pattern.compile(regex.trim());//对比\r\n        Matcher mat = pat.matcher(urls.trim());\r\n        isurl = mat.matches();//判断是否匹配\r\n        if (isurl) {\r\n            isurl = true;\r\n        }\r\n        return isurl;\r\n    }\r\n\r\n\r\n    private Button btn_back;\r\n    private Button btn_newwindow;\r\n    private Button btn_forward;\r\n    private Button btn_menu;\r\n    private Button btn;\r\n    private Button btn_more;\r\n    @Override\r\n    public boolean onCreateOptionsMenu(Menu menu)\r\n    {\r\n        //这里用到了MenuInflater类，使用该类的inflate方法来读取xml文件并且建立菜单\r\n        MenuInflater inflater = getMenuInflater();\r\n        //设置menu界面为res/menu/menu.xml\r\n        inflater.inflate(R.menu.menu, menu);\r\n        return true;\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_main);\r\n        //按钮注册\r\n        btn = (Button)findViewById(R.id.button);\r\n        btn_back = (Button) findViewById(R.id.btn_back);\r\n        btn_newwindow = (Button) findViewById(R.id.btn_exit);\r\n        btn_forward = (Button) findViewById(R.id.btn_forward);\r\n        btn_menu = (Button) findViewById(R.id.btn_menu);\r\n        btn_more=(Button) findViewById(R.id.btn_more) ;\r\n\r\n\r\n        btn_more.setOnClickListener(new View.OnClickListener() {\r\n\r\n            @Override\r\n            public void onClick(View v) {\r\n                //当前这个v就是 button2控件\r\n                PopupMenu popupMenu = new PopupMenu(MainActivity.this, v);\r\n                popupMenu.setOnMenuItemClickListener(new PopupMenu.OnMenuItemClickListener() {\r\n\r\n                    @Override\r\n                    public boolean onMenuItemClick(MenuItem item) {\r\n                        switch (item.getItemId()) {\r\n                            case R.id.history:\r\n                                Intent intent = new Intent(MainActivity.this,historyActivity.class);\r\n                                Bundle bundle=new Bundle();\r\n                                //传递name参数为tinyphp\r\n                                bundle.putStringArrayList(\"history\",urlList);\r\n                                intent.putExtras(bundle);\r\n                                startActivity(intent);\r\n                                break;\r\n                            case R.id.flag:\r\n                                Log.d(\"TAG2\", \"书签\");\r\n                                break;\r\n                            case R.id.add_flag:\r\n                                flagList.add(currenturl);\r\n                                flagList=removeDuplicate(flagList);\r\n                                Log.d(\"array3\", flagList.toString());\r\n                                break;\r\n                        }\r\n                        return false;\r\n                    }\r\n                });\r\n\r\n                MenuInflater inflater = popupMenu.getMenuInflater();\r\n                inflater.inflate(R.menu.menu, popupMenu.getMenu());\r\n                popupMenu.show();\r\n            }\r\n        });\r\n\r\n        //按钮添加监听事件\r\n        btn_back.setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View v){\r\n                if (webView.canGoBack()) {\r\n                    webView.goBack();\r\n                } else {\r\n                    finish();\r\n                }\r\n\r\n            }\r\n        });\r\n        btn_newwindow.setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View v){\r\n                Toast.makeText(getApplicationContext(), \"多窗口\",\r\n                        Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n        btn_forward.setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View v){\r\n                if (webView.canGoForward()) {\r\n                    webView.goForward();\r\n                }\r\n            }\r\n        });\r\n        btn_menu.setOnClickListener(new View.OnClickListener(){\r\n            @Override\r\n            public void onClick(View v){\r\n                LoadUrl(\"https://m.baidu.com/\");\r\n            }\r\n        });\r\n        final EditText myEditText = (EditText) findViewById(R.id.edit_text);\r\n\r\n        btn.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                //url判断并且改成想要的格式\r\n                String str = myEditText.getText().toString();\r\n                if (str.equals(\"\")){\r\n                    str=\"https://m.baidu.com/\";\r\n                }else {\r\n                    if(isUrl(str)){\r\n                        str=\"http://\"+str;\r\n                    }\r\n                    if(!isHttpUrl(str)){\r\n//                         str = \"http://www.baidu.com/baidu?tn=02049043_69_pg&le=utf-8&word=\" + myEditText.getText().toString();\r\n                        str = \"http://m.baidu.com/s?baiduid=8155C2BBA5E753A5E061F6569491FCEB&tn=baidulocal&le=utf-8&word=\" + myEditText.getText().toString()+\"&pu=sz%401321_480&t_noscript=jump\";\r\n                    }\r\n                }\r\n\r\n                initWebView(str);\r\n            }\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/mywebdemo/MainActivity.java	(revision fe9cf299eb2629cf4c6d59b78d09a7315ba61822)
+++ app/src/main/java/com/example/mywebdemo/MainActivity.java	(date 1624241219321)
@@ -15,6 +15,7 @@
 import android.view.MenuItem;
 import android.view.MotionEvent;
 import android.view.View;
+import android.webkit.JsResult;
 import android.webkit.WebChromeClient;
 import android.webkit.WebResourceResponse;
 import android.webkit.WebSettings;
@@ -132,7 +133,10 @@
         Context context = webView.getContext();
         webView.setWebViewClient(new NoAdWebviewClient(context));
         webView.setWebChromeClient(new WebChromeClient(){
-            //
+            @Override
+            public boolean onJsAlert(WebView view, String url, String message, JsResult result) {
+                return super.onJsAlert(view, url, message, result);
+            }
         });
         LoadUrl(url);
         //拦截跳转后执行
